<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>C语言 - 九九</title><meta name="Description" content=""><meta property="og:title" content="C语言" />
<meta property="og:description" content="C语言 C是一种通用的、命令式的计算机编程语言，支持结构化编程、词法变量作用域和递归，而静态类型系统可以防止许多意想不到的操作。通过设计，C提" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dingjingmaster.github.io/2022/05/0002-c%E8%AF%AD%E8%A8%80/" /><meta property="og:image" content="https://dingjingmaster.github.io/img/logo.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-14T21:13:42+08:00" />
<meta property="article:modified_time" content="2022-05-14T21:13:42+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://dingjingmaster.github.io/img/logo.jpg"/>

<meta name="twitter:title" content="C语言"/>
<meta name="twitter:description" content="C语言 C是一种通用的、命令式的计算机编程语言，支持结构化编程、词法变量作用域和递归，而静态类型系统可以防止许多意想不到的操作。通过设计，C提"/>
<meta name="application-name" content="九九">
<meta name="apple-mobile-web-app-title" content="九九"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://dingjingmaster.github.io/2022/05/0002-c%E8%AF%AD%E8%A8%80/" /><link rel="prev" href="https://dingjingmaster.github.io/2022/05/0001-c%E4%B8%8Ec-%E5%90%84%E4%B8%AA%E7%89%88%E6%9C%AC/" /><link rel="next" href="https://dingjingmaster.github.io/2022/05/0000-linux%E5%86%85%E6%A0%B8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "C语言",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/dingjingmaster.github.io\/2022\/05\/0002-c%E8%AF%AD%E8%A8%80\/"
        },"image": ["https:\/\/dingjingmaster.github.io\/img\/logo.jpg"],"genre": "posts","keywords": "linux, C, C\u002b\u002b, C\/C\u002b\u002b","wordcount":  10236 ,
        "url": "https:\/\/dingjingmaster.github.io\/2022\/05\/0002-c%E8%AF%AD%E8%A8%80\/","datePublished": "2022-05-14T21:13:42+08:00","dateModified": "2022-05-14T21:13:42+08:00","publisher": {
            "@type": "Organization",
            "name": "九九","logo": "https:\/\/dingjingmaster.github.io\/img\/logo.jpg"},"author": {
                "@type": "Person",
                "name": "ding jing"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="九九"><span class="header-title-pre"> </span>九九</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="https://github.com/dingjingmaster" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="九九"><span class="header-title-pre"> </span>九九</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="https://github.com/dingjingmaster" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">C语言</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>ding jing</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/c/"><i class="far fa-folder fa-fw"></i>C</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-05-14">2022-05-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 10236 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 21 分钟&nbsp;<span id="/2022/05/0002-c%E8%AF%AD%E8%A8%80/" class="leancloud_visitors" data-flag-title="C语言">
                        <i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#c语言">C语言</a>
      <ul>
        <li><a href="#c编译器">C编译器</a></li>
        <li><a href="#编译器c版本支持">编译器C版本支持</a></li>
        <li><a href="#代码风格">代码风格</a></li>
        <li><a href="#c版本">C版本</a></li>
        <li><a href="#hello-world">hello world</a></li>
      </ul>
    </li>
    <li><a href="#字符类型和转换">字符类型和转换</a>
      <ul>
        <li><a href="#c标准库----ctypeh">C标准库 &ndash; <code>ctype.h</code></a></li>
      </ul>
    </li>
    <li><a href="#别名和有效类型">别名和有效类型</a>
      <ul>
        <li><a href="#例子">例子</a>
          <ul>
            <li><a href="#不能通过非字符类型访问字符类型">不能通过非字符类型访问字符类型</a></li>
            <li><a href="#有效类型">有效类型</a></li>
            <li><a href="#严重违反类型转换规则">严重违反类型转换规则</a></li>
            <li><a href="#限制条件">限制条件</a></li>
            <li><a href="#改变字节">改变字节</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#数组">数组</a>
      <ul>
        <li><a href="#语法">语法</a></li>
        <li><a href="#为什么需要数组">为什么需要数组</a></li>
        <li><a href="#大多数上下文数组隐式转为指针">大多数上下文数组隐式转为指针</a></li>
        <li><a href="#函数参数不是数组">函数参数不是数组</a></li>
        <li><a href="#特殊例子">特殊例子</a></li>
        <li><a href="#变长数组c99c11">变长数组(C99/C11)</a></li>
        <li><a href="#清除数组内容">清除数组内容</a></li>
        <li><a href="#数组长度">数组长度</a></li>
        <li><a href="#设置数组值">设置数组值</a></li>
        <li><a href="#定义数组并访问元素">定义数组并访问元素</a></li>
        <li><a href="#堆上动态分配空间并初始化数组">堆上动态分配空间并初始化数组</a></li>
        <li><a href="#迭代数组">迭代数组</a></li>
        <li><a href="#多维数组">多维数组</a></li>
      </ul>
    </li>
    <li><a href="#断言">断言</a>
      <ul>
        <li><a href="#语法-1">语法</a></li>
        <li><a href="#参数">参数</a></li>
        <li><a href="#例子-1">例子</a>
          <ul>
            <li><a href="#前置条件和后置条件">前置条件和后置条件</a></li>
            <li><a href="#简单断言">简单断言</a></li>
            <li><a href="#静态断言c11">静态断言(C11)</a></li>
            <li><a href="#静态断言c99">静态断言(c99)</a></li>
            <li><a href="#断言不可能到达的位置switch-case语法">断言不可能到达的位置(switch-case语法)</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#原子atomics">原子(Atomics)</a>
      <ul>
        <li><a href="#语法-2">语法</a></li>
        <li><a href="#例子-2">例子</a>
          <ul>
            <li><a href="#原子和操作">原子和操作</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#位域">位域</a>
      <ul>
        <li><a href="#语法-3">语法</a></li>
        <li><a href="#参数-1">参数</a></li>
        <li><a href="#例子-3">例子</a>
          <ul>
            <li><a href="#位域-1">位域</a></li>
            <li><a href="#使用位域作为小整数">使用位域作为小整数</a></li>
            <li><a href="#位域对齐">位域对齐</a></li>
            <li><a href="#什么时候使用位域">什么时候使用位域</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#boolean">Boolean</a>
      <ul>
        <li><a href="#例子-4">例子</a></li>
      </ul>
    </li>
    <li><a href="#命令行参数">命令行参数</a>
      <ul>
        <li><a href="#例子-5">例子</a></li>
      </ul>
    </li>
    <li><a href="#注释">注释</a></li>
    <li><a href="#常见的c编程习惯用法和开发人员实践">常见的C编程习惯用法和开发人员实践</a>
      <ul>
        <li><a href="#比较">比较</a></li>
      </ul>
    </li>
    <li><a href="#常见陷阱">常见陷阱</a></li>
    <li><a href="#编译">编译</a></li>
    <li><a href="#复合类型">复合类型</a>
      <ul>
        <li><a href="#语法-4">语法</a></li>
      </ul>
    </li>
    <li><a href="#头文件包含">头文件包含</a></li>
    <li><a href="#数据类型">数据类型</a></li>
    <li><a href="#声明与定义">声明与定义</a></li>
    <li><a href="#错误处理">错误处理</a>
      <ul>
        <li><a href="#语法-5">语法</a></li>
      </ul>
    </li>
    <li><a href="#文件和-io-流">文件和 I/O 流</a>
      <ul>
        <li><a href="#语法-6">语法</a></li>
      </ul>
    </li>
    <li><a href="#格式化输入输出">格式化输入/输出</a></li>
    <li><a href="#函数参数">函数参数</a></li>
    <li><a href="#函数指针">函数指针</a>
      <ul>
        <li><a href="#语法-7">语法</a></li>
      </ul>
    </li>
    <li><a href="#使用-typedef">使用 typedef</a></li>
    <li><a href="#上下文指针">上下文指针</a></li>
    <li><a href="#标识符作用域">标识符作用域</a></li>
    <li><a href="#实现定义的行为">实现定义的行为</a></li>
    <li><a href="#隐式转换和显示转换">隐式转换和显示转换</a></li>
    <li><a href="#初始化">初始化</a></li>
    <li><a href="#内联汇编">内联汇编</a></li>
    <li><a href="#内联">内联</a></li>
    <li><a href="#进程间通信ipc">进程间通信(IPC)</a></li>
    <li><a href="#迭代语句循环">迭代语句/循环</a>
      <ul>
        <li><a href="#语法-8">语法</a></li>
      </ul>
    </li>
    <li><a href="#跳转">跳转</a>
      <ul>
        <li><a href="#语法-9">语法</a></li>
      </ul>
    </li>
    <li><a href="#链表">链表</a></li>
    <li><a href="#数字字符和字符串的字面值">数字、字符和字符串的字面值</a></li>
    <li><a href="#内存管理">内存管理</a>
      <ul>
        <li><a href="#语法-10">语法</a></li>
      </ul>
    </li>
    <li><a href="#多字字符序列">多字字符序列</a></li>
    <li><a href="#多线程">多线程</a>
      <ul>
        <li><a href="#语法-11">语法</a></li>
      </ul>
    </li>
    <li><a href="#操作符">操作符</a>
      <ul>
        <li><a href="#语法-12">语法</a></li>
      </ul>
    </li>
    <li><a href="#将-2-维数组传给函数">将 2 维数组传给函数</a></li>
    <li><a href="#指针">指针</a>
      <ul>
        <li><a href="#语法-13">语法</a></li>
      </ul>
    </li>
    <li><a href="#预处理器和宏">预处理器和宏</a></li>
    <li><a href="#随机数生成">随机数生成</a>
      <ul>
        <li><a href="#语法-14">语法</a></li>
      </ul>
    </li>
    <li><a href="#条件">条件</a></li>
    <li><a href="#信号处理">信号处理</a></li>
    <li><a href="#标准数学">标准数学</a></li>
    <li><a href="#字符串">字符串</a></li>
    <li><a href="#结构体">结构体</a></li>
    <li><a href="#structure-padding-and-packing">Structure Padding and Packing</a></li>
    <li><a href="#测试框架">测试框架</a>
      <ul>
        <li><a href="#cpputest">CppUTest</a></li>
      </ul>
    </li>
    <li><a href="#线程原生">线程(原生)</a>
      <ul>
        <li><a href="#语法-15">语法</a></li>
      </ul>
    </li>
    <li><a href="#类型限定符">类型限定符</a></li>
    <li><a href="#typedef">typedef</a></li>
    <li><a href="#未定义类型">未定义类型</a></li>
    <li><a href="#联合体">联合体</a></li>
    <li><a href="#valgrind">Valgrind</a></li>
    <li><a href="#变量参数">变量参数</a></li>
    <li><a href="#x-macros">X-macros</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="c语言">C语言</h2>
<p>C是一种通用的、命令式的计算机编程语言，支持结构化编程、词法变量作用域和递归，而静态类型系统可以防止许多意想不到的操作。通过设计，C提供了有效地映射到典型机器指令的构造，因此它在以前用汇编语言编写的应用程序中得到了持久的使用，包括操作系统，以及从超级计算机到嵌入式系统的各种应用程序软件。</p>
<p>尽管具有低级功能，但该语言的设计初衷是鼓励跨平台编程。一个符合标准的、可移植编写的C程序可以用于各种各样的计算机平台和操作系统，只需对其源代码进行很少的更改。从嵌入式微控制器到超级计算机，该语言已经在非常广泛的平台上可用。</p>
<p>C语言最初是由Dennis Ritchie于1969年至1973年在贝尔实验室开发的，用于重新实现Unix操作系统。它已经成为有史以来使用最广泛的编程语言之一，来自不同供应商的C编译器可用于大多数现有的计算机架构和操作系统。</p>
<h3 id="c编译器">C编译器</h3>
<ul>
<li>GCC, GNU 编译器</li>
<li>clang, 是为LLVM项目提供了C语言家族(C, c++, Objective C/c++, OpenCL, CUDA和RenderScript)的编译器</li>
<li>MSCV, 微软C/C++编译器</li>
</ul>
<p><a href="https://www3.ntu.edu.sg/home/ehchua/programming/cpp/gcc_make.html" target="_blank" rel="noopener noreffer">gcc 编译器</a></p>
<h3 id="编译器c版本支持">编译器C版本支持</h3>
<p>编译器不一定完全支持 C 所有特性，同时编译器也可能通过参数支持一些 C 标准没有的特性，使用时候具体参看 C编译器和对应版本说明。</p>
<h3 id="代码风格">代码风格</h3>
<p><a href="https://www.gnu.org/prep/standards/html_node/index.html" target="_blank" rel="noopener noreffer">GNU代码风格</a></p>
<h3 id="c版本">C版本</h3>
<table>
<thead>
<tr>
<th>版本</th>
<th>标准</th>
<th>发行时间</th>
</tr>
</thead>
<tbody>
<tr>
<td>K&amp;E</td>
<td>无</td>
<td>1978-02-22</td>
</tr>
<tr>
<td>C89</td>
<td>ANSI X3.159-1989</td>
<td>1989-12-14</td>
</tr>
<tr>
<td>C90</td>
<td>ISO/IEC 9899:1990</td>
<td>1990-12-20</td>
</tr>
<tr>
<td>C95</td>
<td>ISO/IEC 9899/AMD1:1995</td>
<td>1995-03-30</td>
</tr>
<tr>
<td>C99</td>
<td>ISO/IEC 9899:1999</td>
<td>1999-12-16</td>
</tr>
<tr>
<td>C11</td>
<td>ISO/IEC 9899:2011</td>
<td>2011-12-15</td>
</tr>
</tbody>
</table>
<h3 id="hello-world">hello world</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Hello, World&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>编译</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc hello.c -o hello
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// 我们还可以使用警告选项-Wall -Wextra -Werror，这有助于识别可能导致程序失败或产生意外结果的问题
</span></span><span class="line"><span class="cl">gcc -Wall -Wextra -Werror -o hello hello.c 
</span></span></code></pre></td></tr></table>
</div>
</div><p>对比 K&amp;R C 的Hello world</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;hello, world</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意，在编写《The C programming language》的第一版(1978年)时，C编程语言还没有标准化，而且这个程序可能无法在大多数现代编译器上编译，除非它们被指示接受C90代码。</p>
</blockquote>
<p>K&amp;R书中的第一个示例现在被认为质量很差，部分原因是它缺少main()的显式返回类型，部分原因是它缺少返回语句。</p>
<p>在C89中，main的类型默认为int，但K&amp;R示例不向环境返回定义的值。在C99和以后的标准中，返回类型是必需的，但是省略main的返回语句(而且只有main)是安全的，因为C99 5.1.2.2.3引入了一个特殊情况—它相当于返回0，表示成功。</p>
<h2 id="字符类型和转换">字符类型和转换</h2>
<p>从流中读取字符类型</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;ctype.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">space</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">alnum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">punct</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">chartypes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">chartypes</span> <span class="nf">classify</span><span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">chartypes</span> <span class="n">types</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">ch</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">fgetc</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">types</span><span class="p">.</span><span class="n">space</span> <span class="o">+=</span> <span class="o">!!</span><span class="n">isspace</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">types</span><span class="p">.</span><span class="n">alnum</span> <span class="o">+=</span> <span class="o">!!</span><span class="n">isalnum</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">types</span><span class="p">.</span><span class="n">punct</span> <span class="o">+=</span> <span class="o">!!</span><span class="n">ispunct</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>classify</code>函数从流中读取字符并统计空格、字母数字和标点符号的数量。它需要注意以下几个问题：</p>
<ul>
<li>当从流中读取一个字符时，结果被保存为int，因为读取EOF(文件结束标记)和具有相同位模式的字符之间会有歧义。</li>
<li><code>classify</code>函数希望它们的参数可以表示为unsigned char，或者EOF宏的值。因为这正是fgetc返回的，所以这里不需要转换。</li>
<li>字符分类函数的返回值只区分零(false)和非零(true)。为了计算字符分类出现的次数，需要将该值转换为1或0，这可以通过双重否定实现</li>
</ul>
<h3 id="c标准库----ctypeh">C标准库 &ndash; <code>ctype.h</code></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">isalpha</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks if c is alphabetic (A-Z, a-z), returns non-zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">isalnum</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks if c is alphanumeric (A-Z, a-z, 0-9), returns non-zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">iscntrl</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks is c is a control character (0x00-0x1F, 0x7F), returns zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">isdigit</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks if c is a digit (0-9), returns zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">isgraph</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks if c has a graphical representation (any printing character except space), returns non-zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">islower</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks if c is a lower-case letter (a-z), returns zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">isprint</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks if c is any printable character (including space), returns non-zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">ispunct</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks if c is a punctuation character, returns zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">isspace</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks if c is a white-space character, returns zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">isupper</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>  <span class="cm">/* Checks if c is an upper-case letter (A-Z), returns non-zero here. */</span>
</span></span><span class="line"><span class="cl"><span class="n">isxdigit</span><span class="p">(</span><span class="n">c</span><span class="p">);</span> <span class="cm">/* Checks if c is a hexadecimal digit (A-F, a-f, 0-9), returns non-zero here.*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// C99
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">isblank</span><span class="p">(</span><span class="n">c</span><span class="p">);</span> <span class="cm">/* Checks if c is a blank character (space or tab), returns non-zero here. */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="别名和有效类型">别名和有效类型</h2>
<blockquote>
<p>这里的<code>别名</code>是英文直译，可以理解为我们常见的<code>类型转换</code></p>
</blockquote>
<ul>
<li>别名是指向同一个对象的两个指针a和b的属性，即a == b。</li>
<li>C使用数据对象的有效类型来确定可以对该对象执行哪些操作。具体来说，有效类型用于确定两个指针是否可以相互别名。</li>
</ul>
<p>C语言的严格别名规则是指编译器可能假定哪些对象会(或不会)别名。对于数据指针，你应该记住两条经验法则:</p>
<ul>
<li>除非另有说明，具有相同基类型的两个指针可以别名。</li>
<li>两个具有不同基类型的指针不能别名，除非两个类型中至少有一个是字符类型。</li>
</ul>
<blockquote>
<p>这里的基本类型指的是抛开类型限制，比如const，比如：<code>double* a</code> 和 <code>const double* b</code>，编译器通常必须假设对<code>*a</code>的修改可能会改变<code>*b</code>。</p>
</blockquote>
<p>违反第二条规则会有灾难性后果，所以为了减少问题发生概率，除非源或目标类型为void，否则具有不同基类型的指针之间的所有指针转换都必须是显式的。</p>
<blockquote>
<p>这里必须做的类型转换不包括添加限定符 <code>const</code></p>
</blockquote>
<h3 id="例子">例子</h3>
<h4 id="不能通过非字符类型访问字符类型">不能通过非字符类型访问字符类型</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">a</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span> <span class="kt">int</span><span class="o">*</span> <span class="p">)</span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span> <span class="kt">int</span><span class="o">*</span> <span class="p">)</span><span class="o">&amp;</span><span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">_Thread_local</span> <span class="kt">char</span> <span class="n">d</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span> <span class="kt">int</span><span class="o">*</span> <span class="p">)</span><span class="o">&amp;</span><span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在例子中，一个char数组被重新解释为int类型，并且每次对int指针b解引用时，该行为都是未定义的。因为它违反了“有效类型”规则，具有有效类型的数据对象不能通过非字符类型的其他类型访问。因为这里的另一个类型是int，所以这是不允许的。</p>
<p>即使内存对齐和指针大小是已知的，这也不能免除此规则，行为仍然是未定义的。</p>
<p>这特别意味着，在标准C语言中不可能保留可以通过不同类型的指针使用的字符类型的缓冲区对象，因为您将使用由malloc或类似函数接收的缓冲区。</p>
<p>实现上述目标的正确方法是使用 <code>union</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">union</span> <span class="n">bufType</span> <span class="n">bufType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">union</span> <span class="n">bufType</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">[</span><span class="mi">25</span><span class="p">])];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">bufType</span> <span class="n">a</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span> <span class="c1">// reserve a buffer and initialize
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">i</span><span class="p">;</span> <span class="c1">// no cast necessary
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="n">bufType</span> <span class="n">a</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">_Thread_local</span> <span class="n">bufType</span> <span class="n">a</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span><span class="o">*</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里，union确保编译器从一开始就知道缓冲区可以通过不同的方式访问。这样做的另一个好处是，现在缓冲区有一个a.i，它已经是int类型，不需要进行指针转换。</p>
<h4 id="有效类型">有效类型</h4>
<p>数据对象的有效类型是与之关联的最后一个类型信息(如果有的话)。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// 有效类型是 uint32_t
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">uint32_t</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// *pa的有效类型是 uint32_t
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">uint32_t</span><span class="o">*</span> <span class="n">pa</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 目前 *q 并不是一个有效类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span><span class="o">*</span> <span class="n">q</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span> <span class="kt">uint32_t</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 这里的 q 仍然不是一个有效类型，因为还没有数据写入
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">uint32_t</span><span class="o">*</span> <span class="n">qb</span> <span class="o">=</span> <span class="n">q</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// *qb 目前是一个有效类型 uint32_t，因为一个 uint32_t 值被写入了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">*</span><span class="n">qb</span> <span class="o">=</span> <span class="mi">37</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// r 指向的对象尽管已经初始化了，但还不是有效类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span><span class="o">*</span> <span class="n">r</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span> <span class="kt">uint32_t</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 不是有效类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">uint32_t</span><span class="o">*</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// *rc 已经是一个有效类型 uint32_t 因为一个值从它那读取了
</span></span></span><span class="line"><span class="cl"><span class="c1">// 因为使用 calloc 初始化了，所以读操作是合理的
</span></span></span><span class="line"><span class="cl"><span class="c1">// 此时尽管我们没有写它的值，但是 *rc 已经是一个有效类型了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">uint32_t</span> <span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="n">rc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span><span class="o">*</span> <span class="n">s</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span> <span class="kt">uint32_t</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 因为有 uint32_t 类型复制到指定对象里，所以 *s 已经是有效类型了
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">memcpy</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="k">sizeof</span> <span class="kt">uint32_t</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="严重违反类型转换规则">严重违反类型转换规则</h4>
<p>在下面的代码中，让我们假设<code>float</code>和<code>uint32_t</code>有相同的内存大小</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">fun</span><span class="p">(</span><span class="kt">uint32_t</span><span class="o">*</span> <span class="n">u</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">f</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">u</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="s">&#34;%g should equal %g</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>u 和 f 具有不同的基类型，因此编译器可以假定它们指向不同的对象。</p>
<p>在a和b的两次初始化之间<code>*f</code>不可能发生变化，因此编译器可能会优化代码，使其等价于:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">fun</span><span class="p">(</span><span class="kt">uint32_t</span><span class="o">*</span> <span class="n">u</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">f</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">u</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="s">&#34;%g should equal %g</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>即<code>*f</code>的二次加载操作可以完全优化出来。
如果这样调用:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">float</span> <span class="n">fval</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">uint32_t</span> <span class="n">uval</span> <span class="o">=</span> <span class="mi">77</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">fun</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uval</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 输出:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">4</span> <span class="n">should</span> <span class="n">equal</span> <span class="mi">4</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是如果这样调用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">float</span> <span class="n">fval</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">uint32_t</span><span class="o">*</span> <span class="n">up</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">fval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">fun</span><span class="p">(</span><span class="n">up</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fval</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们违反了严格的混叠规则。然后这种行为就变得没有定义了。如果编译器优化了第二次访问，输出可能与上面一样，或者完全不同，从而使程序最终处于完全不可靠的状态。</p>
<h4 id="限制条件">限制条件</h4>
<p>如果有两个相同类型的指针实参，编译器就不能做任何假设，必须总是假设对<code>*e</code>的修改可能会改变<code>*f</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">fun</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">e</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">f</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="n">f</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="s">&#34;is %g equal to %g?</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">float</span> <span class="n">fval</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">float</span> <span class="n">eval</span> <span class="o">=</span> <span class="mi">77</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">fun</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eval</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fval</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>正常输出是 <code>is 4 equal to 4?</code></p>
<p>如果我们通过一些外部信息知道e和f永远不会指向相同的数据对象，那么这可能是低效的。我们可以通过给指针形参添加限制限定符来反映这一点:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">fan</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="kr">restrict</span> <span class="n">e</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span><span class="kr">restrict</span> <span class="n">f</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="n">f</span> <span class="o">*</span><span class="n">e</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="s">&#34;is %g equal to %g?</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>那么编译器可能总是假设e和f指向不同的对象。</p>
<h4 id="改变字节">改变字节</h4>
<p>一旦对象具有有效类型，就不应该试图通过其他类型的指针修改它，除非其他类型是字符类型、char、signed char或 unsigned char。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;inttypes.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">57</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// conversion from incompatible types needs a cast !
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ap</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">sizeof</span> <span class="n">a</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* set each byte of a to 42 */</span>
</span></span><span class="line"><span class="cl">        <span class="n">ap</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;a now has value %&#34;</span> <span class="n">PRIu32</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>打印结果: <code>a now has value 707406378</code>
正常是因为：</p>
<ul>
<li>使用unsigned char类型访问单个字节，因此每次修改都有很好的定义。</li>
<li>对象的两个视图，通过别名a和<code>*ap</code>，但由于ap是指向字符类型的指针，因此不适用严格的别名规则。因此，编译器必须假设a的值可能在for循环中被更改了。a的修改值必须从已更改的字节构造。</li>
<li>a的类型的<code>uint32_t</code>没有填充位。其表示的所有位都为值计数，这里是707406378，并且不能有陷阱表示。</li>
</ul>
<h2 id="数组">数组</h2>
<p>数组是派生数据类型，表示另一种类型的值(“元素”)的有序集合。C语言中的大多数数组都有固定数量的任意一种类型的元素，其表示形式是连续地将元素存储在内存中，没有间隔或填充。C允许多维数组，它的元素是其他数组，也可以是指针数组。</p>
<p>C支持动态分配数组，其大小在运行时确定。C99及以后版本支持可变长度数组或VLAs。</p>
<h3 id="语法">语法</h3>
<ul>
<li>type name[length];</li>
<li>int arr[10] = {0}; // 初始化所有元素为0</li>
<li>int arr[10] = {42}; // 初始化第一个元素为42，其它为0</li>
<li>int arr[] = {4, 2, 3, 1};</li>
<li>arr[n] = value;</li>
<li>value = arr[n];</li>
</ul>
<h3 id="为什么需要数组">为什么需要数组</h3>
<p>数组提供了一种将对象组织成具有自身意义的聚合的方法。例如，C字符串是字符数组(chars)，而像“Hello, World!”这样的字符串具有聚合的意义，它不是单个字符固有的。类似地，数组通常用于表示数学向量和矩阵，以及多种类型的列表。此外，如果没有对元素进行分组的方法，就需要单独处理每个元素，比如通过单独的变量。它不仅笨重，而且不能方便地容纳不同长度的集合。</p>
<h3 id="大多数上下文数组隐式转为指针">大多数上下文数组隐式转为指针</h3>
<p>除了 <code>sizeof</code> 操作，使用 <code>_Alignof</code> 操作、<code>&amp;</code>操作、迭代字符串，它都会转换为第一个元素首地址。</p>
<p>这个隐式转换与数组下标操作符<code>([])</code>的定义紧密耦合:表达式<code>arr[idx]</code>被定义为等价于<code>*(arr + idx)</code>。此外，由于指针算法是可交换的，<code>*(arr + idx)</code>也等价于<code>*(idx + arr)</code>，而<code>*(idx + arr)</code>又等价于<code>idx[arr]</code>。如果<code>idx</code>或<code>arr</code>是指针(或数组，可衰变为指针)，另一个是整数，且整数是指针所指向数组的有效索引，则所有这些表达式都是有效的，计算结果相同。</p>
<p>作为一个特例，观察<code>&amp;(arr[0])</code>等价于<code>&amp;*(arr + 0)</code>，简化为<code>arr</code>。所有的这些表达式都是可互换的(<code>attr</code>最衰减到指针)。这只是再次表示数组衰变为指向其第一个元素的指针。</p>
<p>相反，如果地址操作符应用于类型为<code>T[N]</code>的数组(即<code>&amp;arr</code>)，则结果类型为<code>T (*)[N]</code>并指向整个数组。这与指向数组第一个元素的指针不同，至少在指针算术方面是不同的，指针是根据指向类型的大小定义的。</p>
<h3 id="函数参数不是数组">函数参数不是数组</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>尽管foo的第一个声明对参数a使用了类似数组的语法，但这种语法用于声明一个函数参数，将该参数声明为指向数组元素类型的指针。因此，foo()的第二个签名在语义上与第一个签名相同。这对应于数组值的衰减指针出现作为一个函数调用的参数,这样,如果一个变量和一个函数参数声明相同的数组类型,变量的值是适用于一个函数调用的参数与参数有关。</p>
<h3 id="特殊例子">特殊例子</h3>
<p>特殊的初始化：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">array</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span> <span class="cm">/* array is {0, 2, 5, 0, 9} */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">array</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span> <span class="cm">/* size is 4 */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>不允许声明零长度的数组</p>
</blockquote>
<h3 id="变长数组c99c11">变长数组(C99/C11)</h3>
<p>可变长度数组(简称VLA)是在C99中添加的，在C11中是可选的。它们与普通数组相同，但有一个重要的区别:在编译时不必知道长度。VLA具有自动存储期限。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">size_t</span> <span class="n">m</span> <span class="o">=</span> <span class="n">calc_length</span><span class="p">();</span> <span class="cm">/* calculate array length at runtime */</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">vla</span><span class="p">[</span><span class="n">m</span><span class="p">];</span> <span class="cm">/* create array with calculated length */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>重要: VLA有潜在的危险。如果上面示例中的数组vla需要的堆栈空间大于可用空间，则堆栈将溢出。因此不建议使用VLA</p>
</blockquote>
<h3 id="清除数组内容">清除数组内容</h3>
<p>有时需要在初始化完成后将数组设置为零。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt; /* for EXIT_SUCCESS */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define ARRLEN (10)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">array</span><span class="p">[</span><span class="n">ARRLEN</span><span class="p">];</span> <span class="cm">/* Allocated but not initialised, as not defined static or global. */</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRLEN</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>或者使用 <code>memset</code></p>
<h3 id="数组长度">数组长度</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">sizeof</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="设置数组值">设置数组值</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">array</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="p">[</span><span class="n">array</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">*</span><span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="n">array</span><span class="p">)</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 获取值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">val</span> <span class="o">=</span> <span class="mi">4</span><span class="p">[</span><span class="n">array</span><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="定义数组并访问元素">定义数组并访问元素</h3>
<h3 id="堆上动态分配空间并初始化数组">堆上动态分配空间并初始化数组</h3>
<h3 id="迭代数组">迭代数组</h3>
<h3 id="多维数组">多维数组</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">type</span> <span class="n">name</span><span class="p">[</span><span class="n">size1</span><span class="p">][</span><span class="n">size2</span><span class="p">]...[</span><span class="n">sizeN</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">10</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 初始化 3 维数组
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="断言">断言</h2>
<p>在软件遇到断言时，提出的条件必须为真。最常见的是在执行时进行验证的简单断言。静态断言是在编译时检查的。</p>
<h3 id="语法-1">语法</h3>
<ul>
<li><code>assert(expression);</code></li>
<li><code>static_assert(expression, message);</code></li>
<li><code>_Static_assert(expression, message);</code></li>
</ul>
<h3 id="参数">参数</h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>expression</td>
<td>表达式，判断条件是否满足</td>
</tr>
<tr>
<td>message</td>
<td>诊断消息中包含的字符串字面值</td>
</tr>
</tbody>
</table>
<p><code>assert</code> 和 <code>static_assert</code> 都在 <code>assert.h</code> 中定义。</p>
<p>assert的定义依赖于宏NDEBUG，该宏没有被标准库定义。如果定义了NDEBUG，则assert为无操作:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#ifdef NDEBUG
</span></span></span><span class="line"><span class="cl"><span class="cp"># define assert(condition) ((void) 0)
</span></span></span><span class="line"><span class="cl"><span class="cp">#else
</span></span></span><span class="line"><span class="cl"><span class="cp"># define assert(condition) </span><span class="cm">/* implementation defined */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>使用 assert 会导致程序退出，生产环境中不要用 assert，最好使用条件判断</p>
</blockquote>
<p><code>static_assert</code>扩展为<code>_Static_assert</code>，这是一个关键字。<code>condition</code> 在编译时被检查，因此<code>condition</code>必须是一个常量表达式。没有必要在开发和生产之间以不同的方式处理这个问题</p>
<h3 id="例子-1">例子</h3>
<h4 id="前置条件和后置条件">前置条件和后置条件</h4>
<p>断言的一个用例是前置条件和后置条件。这对于保持不变和契约式设计非常有用。例如，长度总是0或正的，因此该函数必须返回0或正的值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">length2</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* Precondition: */</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* NULL is an invalid vector */</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* Number of dimensions can not be negative.*/</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* Calculation */</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* Postcondition: */</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Resulting length can not be negative. */</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span> <span class="p">(</span><span class="n">result</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="简单断言">简单断言</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="cm">/* Uncomment to disable `assert()` */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* #define NDEBUG */</span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;x = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行输出:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">a.out: main.c:9: main: Assertion `x &gt;= 0&#39; failed.
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="静态断言c11">静态断言(C11)</h4>
<p>静态断言用于在编译代码时检查条件是否为真。如果不是，则需要编译器发出错误消息并停止编译过程。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">enum</span> <span class="p">{</span><span class="n">N</span> <span class="o">=</span> <span class="mi">5</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">_Static_assert</span><span class="p">(</span><span class="n">N</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span> <span class="s">&#34;N does not equal 5&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">static_assert</span><span class="p">(</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#34;N is not greater than 10&#34;</span><span class="p">);</span> <span class="cm">/* compiler error */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="静态断言c99">静态断言(c99)</h4>
<p>在<code>C11</code>之前，没有对静态断言的直接支持。但是，在<code>C99</code>中，可以使用宏模拟静态断言，如果编译时条件为假，则会触发编译失败。与<code>_Static_assert</code>不同，第二个参数需要是适当名称，以便可以使用它创建变量名称。如果断言失败，则在编译器错误中可以看到变量名，因为该变量是在语法不正确的数组声明中使用的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define STATIC_MSG(msg, l) STATIC_MSG2(msg, l)
</span></span></span><span class="line"><span class="cl"><span class="cp">#define STATIC_MSG2(msg,l) on_line_##l##__##msg
</span></span></span><span class="line"><span class="cl"><span class="cp">#define STATIC_ASSERT(x, msg) extern char STATIC_MSG(msg, __LINE__) [(x)?1:-1]
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">enum</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">STATIC_ASSERT</span><span class="p">(</span><span class="n">N</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span> <span class="n">N_must_equal_5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">STATIC_ASSERT</span><span class="p">(</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">N_must_be_greater_than_5</span><span class="p">);</span> <span class="cm">/* compile error */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在C99之前，不能在块中的任意位置声明变量，因此在使用这个宏时必须非常谨慎，确保它只出现在变量声明有效的地方</p>
<h4 id="断言不可能到达的位置switch-case语法">断言不可能到达的位置(switch-case语法)</h4>
<h2 id="原子atomics">原子(Atomics)</h2>
<p>Atomics作为C语言的一部分是自C11以来可用的可选特性。它们的目的是确保对在不同线程之间共享的变量的无竞争访问。如果没有原子限定，如果两个线程并发访问一个共享变量，那么它的状态将是未定义的。例如，一个自增操作(++)可以被拆分为几个汇编指令、一个读取指令、加法本身和一个存储指令。如果另一个线程要执行相同的操作，它们的两个指令序列可能会交织在一起，导致不一致的结果。</p>
<ul>
<li>Types: 除数组类型外，所有对象类型都可以限定为 <code>_Atomic</code></li>
<li>Operators: 它们上的所有读-修改-写操作符都保证是原子的</li>
<li>Operations: 还有其他一些被指定为类型泛型函数的操作，例如<code>atomic_compare_exchange</code>。</li>
<li>Threads: 当它们被不同的线程访问时，对它们的访问保证不会产生数据竞争。</li>
<li>Signal handlers: 如果对原子类型的所有操作都是无状态的，则称为无锁类型。在这种情况下，它们还可以用于处理正常控制流和信号处理程序之间的状态变化。</li>
<li>只有一种数据类型保证是无锁的:<code>atomic_flag</code>。这是一种最小类型，其操作旨在映射到有效的测试和设置硬件指令。</li>
</ul>
<p>在C11的线程接口中还有其他避免竞争条件的方法，特别是一个互斥类型<code>mtx_t</code>，它可以相互排除线程访问关键数据或代码的关键部分。如果原子不可用，则必须使用它们来防止竞争。</p>
<h3 id="语法-2">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#ifdef __STDC_NO_ATOMICS__
</span></span></span><span class="line"><span class="cl"><span class="cp"># error this implementation needs atomics•
</span></span></span><span class="line"><span class="cl"><span class="cp">#endif•
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdatomic.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">unsigned</span> <span class="n">_Atomic</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">ATOMIC_VAR_INIT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="例子-2">例子</h3>
<h4 id="原子和操作">原子和操作</h4>
<p>可以在不同的线程之间并发地访问原子变量，而不需要创建竞争条件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">unsigned</span> <span class="n">_Atomic</span> <span class="n">active</span> <span class="o">=</span> <span class="n">ATOMIC_VAR_INIT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">myThread</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">a</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">++</span><span class="n">active</span><span class="p">;</span> <span class="c1">// increment active race free
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// do something
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="o">--</span><span class="n">active</span><span class="p">;</span> <span class="c1">// decrement active race free
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>基类型允许的所有左值操作(修改对象的操作)都是允许的，不会导致访问它们的不同线程之间的竞争条件。</p>
<ul>
<li>对原子对象的操作通常比普通的算术操作慢几个数量级。这也包括简单的加载或存储操作。所以你应该只在关键的任务中使用它们。</li>
<li>通常的算术运算和赋值，如a = a+1;实际上在a上有三个操作:首先是加载，然后是加法，最后是存储。只有操作a += 1;和++;是这样的。</li>
</ul>
<h2 id="位域">位域</h2>
<p>C语言中大多数变量的大小都是字节的整数。位域是结构的一部分，不一定占用整数字节;它们可以使用任意数量的比特。多个位域可以被打包到一个存储单元中。它们是标准C的一部分，但有许多方面是实现定义的。它们是C语言中最不可移植的部分之一。</p>
<h3 id="语法-3">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">type</span><span class="o">-</span><span class="n">specifier</span> <span class="nl">identifier</span> <span class="p">:</span> <span class="n">size</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="参数-1">参数</h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>type-specifier</td>
<td><code>signed</code>、<code>unsigned</code>、<code>int</code> 或 <code>_Bool</code></td>
</tr>
<tr>
<td>identifier</td>
<td>名字</td>
</tr>
<tr>
<td>size</td>
<td>字段中使用的位数</td>
</tr>
</tbody>
</table>
<blockquote>
<p>位字段的可移植类型只有<code>signed</code>、<code>unsigned</code>或<code>_Bool</code>。也可以使用纯<code>int</code>类型，但标准规定对于位域，说明符int是否指定与signed int相同的类型或与unsigned int相同的类型由实现定义。特定的实现可能允许其他整数类型，但使用它们是不可移植的。</p>
</blockquote>
<h3 id="例子-3">例子</h3>
<h4 id="位域-1">位域</h4>
<p>一个简单的位域可以用来描述可能包含特定位数的事物。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">encoderPosition</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">encoderCounts</span> <span class="p">:</span> <span class="mi">23</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">encoderTurns</span> <span class="p">:</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">_reserved</span> <span class="p">:</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这个例子中，我们考虑一个编码器，它有23位单精度，4位描述多匝。当与输出与特定位数相关联的数据的硬件连接时，经常使用位域。另一个例子可能是与FPGA通信，FPGA以32位段的形式将数据写入内存，允许硬件读取:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">FPGAInfo</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">union</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">struct</span> <span class="n">bits</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">bulb1On</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">bulb2On</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">bulb1Off</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">bulb2Off</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">jetOn</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>对于这个示例，我们展示了一个常用的构造，它能够访问单个位的数据，或者将数据包作为一个整体写入(模拟FPGA可能做的事情)。然后我们可以像这样访问比特:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">FPGAInfo fInfo;
</span></span><span class="line"><span class="cl">fInfo.data = 0xFF34F;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">if (fInfo.bits.bulb1On) {
</span></span><span class="line"><span class="cl">    printf(&#34;Bulb 1 is on\n&#34;);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这是有效的，但根据C99标准6.7.2.1，第10项:单位内位域的分配顺序(高阶到低阶或低阶到高阶)是由实现定义的</p>
<p>在以这种方式定义位域时，需要注意字节序。因此，可能需要使用一个预处理器指令来检查机器的字节顺序。下面是一个例子:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">bits</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="cp">#if defined(WIN32) || defined(LITTLE_ENDIAN)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>        <span class="kt">uint8_t</span> <span class="nl">commFailure</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint8_t</span> <span class="nl">hardwareFailure</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint8_t</span> <span class="nl">_reserved</span> <span class="p">:</span><span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#else
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>        <span class="kt">uint8_t</span> <span class="nl">_reserved</span> <span class="p">:</span><span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint8_t</span> <span class="nl">hardwareFailure</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint8_t</span> <span class="nl">commFailure</span> <span class="p">:</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">hardwareStatus</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="使用位域作为小整数">使用位域作为小整数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* define a small bit-field that can hold values from 0 .. 7 */</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nl">uint3</span><span class="p">:</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="n">small</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* extract the right 3 bits from a value */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="cm">/* Binary 11111101 */</span>
</span></span><span class="line"><span class="cl">    <span class="n">small</span><span class="p">.</span><span class="n">uint3</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span> <span class="cm">/* Binary 101 */</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="n">small</span><span class="p">.</span><span class="n">uint3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* This is in effect an infinite loop */</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">small</span><span class="p">.</span><span class="n">uint3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">small</span><span class="p">.</span><span class="n">uint3</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">small</span><span class="p">.</span><span class="n">uint3</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">small</span><span class="p">.</span><span class="n">uint3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="位域对齐">位域对齐</h4>
<p>位域提供了声明小于字符宽度的结构域的能力。位域通过字节级或字级掩码实现。下面的示例产生一个8字节的结构。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">C</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="kt">short</span> <span class="n">s</span><span class="p">;</span> <span class="cm">/* 2 bytes */</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">c</span><span class="p">;</span> <span class="cm">/* 1 byte */</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nl">bit1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* 1 bit */</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nl">nib</span> <span class="p">:</span> <span class="mi">4</span><span class="p">;</span> <span class="cm">/* 4 bits padded up to boundary of 8 bits. Thus 3 bits are padded */</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nl">sept</span> <span class="p">:</span> <span class="mi">7</span><span class="p">;</span> <span class="cm">/* 7 Bits septet, padded up to boundary of 32 bits. */</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注释描述了一种可能的布局，但由于标准说可寻址存储单元的对齐方式未指定，所以也可能有其他布局。</p>
<p>未命名位域可以是任何大小，但不能初始化或引用它们。</p>
<p>不能给零宽度位域指定名称并将下一个字段与位域的数据类型定义的边界对齐。这是通过在位域之间填充位来实现的。</p>
<p><code>struct A</code>的大小是1字节。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">A</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nl">c1</span> <span class="p">:</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nl">c2</span> <span class="p">:</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nl">c3</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在<code>struct B</code>中，第一个未命名位域跳过2位;c2之后的零宽度位域导致c3从字符边界开始(因此在c2和c3之间跳过3位。c4之后有3个填充位。因此，该结构的大小为2字节。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">B</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nl">c1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span> <span class="cm">/* Skips 2 bits in the layout */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nl">c2</span> <span class="p">:</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* Causes padding up to next container boundary */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nl">c3</span> <span class="p">:</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nl">c4</span> <span class="p">:</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="什么时候使用位域">什么时候使用位域</h4>
<p>位域用于将多个变量组合成一个对象，类似于结构。这允许减少内存使用，在嵌入式环境中尤其有用</p>
<h2 id="boolean">Boolean</h2>
<p>要使用预定义的类型<code>_Bool</code>和头文件<code>&lt;stdbool.h&gt;</code>，必须使用<code>C99/C11</code>版本的C语言。为了避免编译器警告和可能的错误，只有在使用C89和该语言以前的版本时，才应该使用typedef/define示例。</p>
<h3 id="例子-4">例子</h3>
<h2 id="命令行参数">命令行参数</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="例子-5">例子</h3>
<h2 id="注释">注释</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// c99 及其之后
</span></span></span><span class="line"><span class="cl"><span class="c1">// ... 
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="常见的c编程习惯用法和开发人员实践">常见的C编程习惯用法和开发人员实践</h2>
<h3 id="比较">比较</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// 不好
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">//Bad-way
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">doSomething</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 好
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="c1">//Good-way
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">doSomething</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="常见陷阱">常见陷阱</h2>
<h2 id="编译">编译</h2>
<h2 id="复合类型">复合类型</h2>
<p>像字符串字面量一样，const限定的复合字面量可以放在只读内存中，甚至可以共享。例如,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;abc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">==</span> <span class="s">&#34;abc&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="语法-4">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">(</span><span class="n">type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">initializer</span><span class="o">-</span><span class="n">list</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="头文件包含">头文件包含</h2>
<h2 id="数据类型">数据类型</h2>
<h2 id="声明与定义">声明与定义</h2>
<h2 id="错误处理">错误处理</h2>
<h3 id="语法-5">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt;•</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="n">errno</span><span class="p">;</span> <span class="cm">/* implementation defined */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;•</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">char</span> <span class="o">*</span><span class="n">strerror</span><span class="p">(</span><span class="kt">int</span> <span class="n">errnum</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;•</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="n">perror</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="文件和-io-流">文件和 I/O 流</h2>
<h3 id="语法-6">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; /* Include this to use any of the following sections */•</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">FILE</span> <span class="o">*</span><span class="nf">fopen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mode</span><span class="p">);</span> <span class="cm">/* Open a stream on the file at path with
</span></span></span><span class="line"><span class="cl"><span class="cm">the specified mode */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">FILE</span> <span class="o">*</span><span class="nf">freopen</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span> <span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span> <span class="cm">/* Re-open an existing
</span></span></span><span class="line"><span class="cl"><span class="cm">stream on the file at path with the specified mode */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">fclose</span><span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span> <span class="cm">/* Close an opened stream */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">size_t</span> <span class="n">fread</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span> <span class="cm">/* Read at most nmemb
</span></span></span><span class="line"><span class="cl"><span class="cm">elements of size bytes each from the stream and write them in ptr. Returns the number of
</span></span></span><span class="line"><span class="cl"><span class="cm">read elements. */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">size_t</span> <span class="nf">fwrite</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span> <span class="cm">/* Write nmemb
</span></span></span><span class="line"><span class="cl"><span class="cm">elements of size bytes each from ptr to the stream. Returns the number of written elements.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">fseek</span><span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">,</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">whence</span><span class="p">);</span> <span class="cm">/* Set the cursor of the stream to offset,
</span></span></span><span class="line"><span class="cl"><span class="cm">relative to the offset told by whence, and returns 0 if it succeeded. */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="nf">ftell</span><span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span> <span class="cm">/* Return the offset of the current cursor position from the beginning
</span></span></span><span class="line"><span class="cl"><span class="cm">of the stream. */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">rewind</span><span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span> <span class="cm">/* Set the cursor position to the beginning of the file. */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">fprintf</span><span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">fout</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span> <span class="cm">/* Writes printf format string on fout */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">FILE</span> <span class="o">*</span><span class="n">stdin</span><span class="p">;</span> <span class="cm">/* Standard input stream */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">FILE</span> <span class="o">*</span><span class="n">stdout</span><span class="p">;</span> <span class="cm">/* Standard output stream */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">FILE</span> <span class="o">*</span><span class="n">stderr</span><span class="p">;</span> <span class="cm">/* Standard error stream */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="格式化输入输出">格式化输入/输出</h2>
<h2 id="函数参数">函数参数</h2>
<h2 id="函数指针">函数指针</h2>
<h3 id="语法-7">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="o">-</span> <span class="err">`</span><span class="n">returnType</span> <span class="p">(</span><span class="o">*</span><span class="n">name</span><span class="p">)(</span><span class="n">parameters</span><span class="p">);</span><span class="err">`</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="err">`</span><span class="k">typedef</span> <span class="n">returnType</span> <span class="p">(</span><span class="o">*</span><span class="n">name</span><span class="p">)(</span><span class="n">parameters</span><span class="p">);</span><span class="err">`</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="err">`</span><span class="k">typedef</span> <span class="n">returnType</span> <span class="n">Name</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="err">`</span><span class="k">typedef</span> <span class="n">returnType</span> <span class="n">Name</span><span class="p">(</span><span class="n">parameters</span><span class="p">);</span><span class="err">`</span>
</span></span><span class="line"><span class="cl">  <span class="err">`</span><span class="k">typedef</span> <span class="n">Name</span> <span class="o">*</span><span class="n">NamePtr</span><span class="p">;</span><span class="err">`</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="使用-typedef">使用 typedef</h2>
<h2 id="上下文指针">上下文指针</h2>
<h2 id="标识符作用域">标识符作用域</h2>
<h2 id="实现定义的行为">实现定义的行为</h2>
<h2 id="隐式转换和显示转换">隐式转换和显示转换</h2>
<h2 id="初始化">初始化</h2>
<h2 id="内联汇编">内联汇编</h2>
<h2 id="内联">内联</h2>
<h2 id="进程间通信ipc">进程间通信(IPC)</h2>
<h2 id="迭代语句循环">迭代语句/循环</h2>
<h3 id="语法-8">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/* all versions */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">([</span><span class="n">expression</span><span class="p">];</span> <span class="p">[</span><span class="n">expression</span><span class="p">];</span> <span class="p">[</span><span class="n">expression</span><span class="p">])</span> <span class="n">one_statement</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">([</span><span class="n">expression</span><span class="p">];</span> <span class="p">[</span><span class="n">expression</span><span class="p">];</span> <span class="p">[</span><span class="n">expression</span><span class="p">])</span> <span class="p">{</span> <span class="n">zero</span> <span class="n">or</span> <span class="n">several</span> <span class="n">statements</span> <span class="p">}</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="n">expression</span><span class="p">)</span> <span class="n">one_statement</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="n">expression</span><span class="p">)</span> <span class="p">{</span> <span class="n">zero</span> <span class="n">or</span> <span class="n">several</span> <span class="n">statements</span> <span class="p">}</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span> <span class="n">one_statement</span> <span class="k">while</span> <span class="p">(</span><span class="n">expression</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span> <span class="p">{</span> <span class="n">one</span> <span class="n">or</span> <span class="n">more</span> <span class="n">statements</span> <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">expression</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// since C99 in addition to the form above•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="n">declaration</span><span class="p">;</span> <span class="p">[</span><span class="n">expression</span><span class="p">];</span> <span class="p">[</span><span class="n">expression</span><span class="p">])</span> <span class="n">one_statement</span><span class="p">;</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="n">declaration</span><span class="p">;</span> <span class="p">[</span><span class="n">expression</span><span class="p">];</span> <span class="p">[</span><span class="n">expression</span><span class="p">])</span> <span class="p">{</span> <span class="n">zero</span> <span class="n">or</span> <span class="n">several</span> <span class="n">statements</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="跳转">跳转</h2>
<h3 id="语法-9">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="cm">/* Returns from the current function. val can be a value of any type that is converts to the function&#39;s return type. */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">return</span><span class="p">;</span> <span class="cm">/* Returns from the current void-function. */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">break</span><span class="p">;</span> <span class="cm">/* Unconditionally jumps beyond the end (&#34;breaks out&#34;) of an Iteration Statement (loop) or out of the innermost switch statement. */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">continue</span><span class="p">;</span> <span class="cm">/* Unconditionally jumps to the beginning of an Iteration Statement (loop). */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">goto</span> <span class="n">LBL</span><span class="p">;</span> <span class="cm">/* Jumps to label LBL. */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="nl">LBL</span><span class="p">:</span> <span class="n">statement</span> <span class="cm">/* any statement in the same function. */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="链表">链表</h2>
<h2 id="数字字符和字符串的字面值">数字、字符和字符串的字面值</h2>
<h2 id="内存管理">内存管理</h2>
<h3 id="语法-10">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">aligned_alloc</span><span class="p">(</span><span class="n">size_t</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">);</span> <span class="cm">/* Only since C11 */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="n">calloc</span><span class="p">(</span><span class="n">size_t</span> <span class="n">nelements</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">free</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="n">malloc</span><span class="p">(</span><span class="n">size_t</span> <span class="n">size</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="n">realloc</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="n">alloca</span><span class="p">(</span><span class="n">size_t</span> <span class="n">size</span><span class="p">);</span> <span class="cm">/* from alloca.h, not standard, not portable, dangerous. */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="多字字符序列">多字字符序列</h2>
<h2 id="多线程">多线程</h2>
<h3 id="语法-11">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">thrd_t</span> <span class="c1">// Implementation-defined complete object type identifying a thread•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">thrd_create</span><span class="p">(</span> <span class="n">thrd_t</span> <span class="o">*</span><span class="n">thr</span><span class="p">,</span> <span class="n">thrd_start_t</span> <span class="n">func</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span> <span class="p">);</span> <span class="c1">// Creates a thread•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">thrd_equal</span><span class="p">(</span> <span class="n">thrd_t</span> <span class="n">thr0</span><span class="p">,</span> <span class="n">thrd_t</span> <span class="n">thr1</span> <span class="p">);</span> <span class="c1">// Check if arguments refer to the same thread•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">thr_t</span> <span class="nf">thrd_current</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span> <span class="c1">// Returns identifier of the thread that calls it•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">thrd_sleep</span><span class="p">(</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">duration</span><span class="p">,</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">remaining</span> <span class="p">);</span> <span class="c1">// Suspend call
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">thread</span> <span class="n">execution</span> <span class="k">for</span> <span class="n">at</span> <span class="n">least</span> <span class="n">a</span> <span class="n">given</span> <span class="n">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">thrd_yield</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span> <span class="c1">// Permit other threads to run instead of the thread that calls it•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">_Noreturn</span> <span class="kt">void</span> <span class="nf">thrd_exit</span><span class="p">(</span> <span class="kt">int</span> <span class="n">res</span> <span class="p">);</span> <span class="c1">// Terminates the thread the thread that calls it•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">thrd_detatch</span><span class="p">(</span> <span class="n">thrd_t</span> <span class="n">thr</span><span class="p">;</span> <span class="c1">// Detaches a given thread from the current environment•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">thrd_join</span><span class="p">(</span> <span class="n">thrd_t</span> <span class="n">thr</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">res</span> <span class="p">);</span> <span class="c1">// Blocks the current thread until the given thread finishes
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="操作符">操作符</h2>
<h3 id="语法-12">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">expr1</span> <span class="n">operator</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">operator</span> <span class="n">expr2</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">expr1</span> <span class="n">operator</span> <span class="n">expr2</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">expr1</span> <span class="o">?</span> <span class="nl">expr2</span> <span class="p">:</span> <span class="n">expr3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="将-2-维数组传给函数">将 2 维数组传给函数</h2>
<h2 id="指针">指针</h2>
<h3 id="语法-13">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">Data</span> <span class="n">type</span><span class="o">&gt;</span> <span class="o">*&lt;</span><span class="n">Variable</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">;</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="n">ptrToInt</span><span class="p">;</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="n">ptrToVoid</span><span class="p">;</span> <span class="cm">/* C89+ */</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">someStruct</span> <span class="o">*</span><span class="n">ptrToStruct</span><span class="p">;</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">**</span><span class="n">ptrToPtrToInt</span><span class="p">;</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="n">length</span><span class="p">];</span> <span class="kt">int</span> <span class="o">*</span><span class="n">ptrToFirstElem</span> <span class="o">=</span> <span class="n">arr</span><span class="p">;</span> <span class="cm">/* For &lt;C99 &#39;length&#39; needs to be a compile time constant, for &gt;=C11 it might need to be one. */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="o">*</span><span class="n">arrayOfPtrsToInt</span><span class="p">[</span><span class="n">length</span><span class="p">];</span> <span class="cm">/* For &lt;C99 &#39;length&#39; needs to be a compile time constant, for &gt;=C11 it might need to be one. */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="预处理器和宏">预处理器和宏</h2>
<h2 id="随机数生成">随机数生成</h2>
<h3 id="语法-14">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">arc4random</span><span class="p">()</span> <span class="p">(</span><span class="n">available</span> <span class="n">on</span> <span class="n">OS</span> <span class="n">X</span> <span class="n">and</span> <span class="n">BSD</span><span class="p">)</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">random</span><span class="p">()</span> <span class="p">(</span><span class="n">available</span> <span class="n">on</span> <span class="n">Linux</span><span class="p">)</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">drand48</span><span class="p">()</span> <span class="p">(</span><span class="n">available</span> <span class="n">on</span> <span class="n">POSIX</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="条件">条件</h2>
<h2 id="信号处理">信号处理</h2>
<h2 id="标准数学">标准数学</h2>
<h2 id="字符串">字符串</h2>
<h2 id="结构体">结构体</h2>
<h2 id="structure-padding-and-packing">Structure Padding and Packing</h2>
<h2 id="测试框架">测试框架</h2>
<h3 id="cpputest">CppUTest</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;CppUTest/CommandLineTestRunner.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;CppUTest/TestHarness.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">TEST_GROUP</span><span class="p">(</span><span class="n">Foo_Group</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="n">TEST</span><span class="p">(</span><span class="n">Foo_Group</span><span class="p">,</span> <span class="n">Foo_TestOne</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="cm">/* Test runner may be provided options, such
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="线程原生">线程(原生)</h2>
<h3 id="语法-15">语法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#ifndef __STDC_NO_THREADS__•
</span></span></span><span class="line"><span class="cl"><span class="cp"># include &lt;threads.h&gt;•
</span></span></span><span class="line"><span class="cl"><span class="cp">#endif•
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">call_once</span><span class="p">(</span><span class="n">once_flag</span> <span class="o">*</span><span class="n">flag</span><span class="p">,</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)(</span><span class="kt">void</span><span class="p">));</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">cnd_broadcast</span><span class="p">(</span><span class="n">cnd_t</span> <span class="o">*</span><span class="n">cond</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">cnd_destroy</span><span class="p">(</span><span class="n">cnd_t</span> <span class="o">*</span><span class="n">cond</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">cnd_init</span><span class="p">(</span><span class="n">cnd_t</span> <span class="o">*</span><span class="n">cond</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">cnd_signal</span><span class="p">(</span><span class="n">cnd_t</span> <span class="o">*</span><span class="n">cond</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">cnd_timedwait</span><span class="p">(</span><span class="n">cnd_t</span> <span class="o">*</span><span class="kr">restrict</span> <span class="n">cond</span><span class="p">,</span> <span class="n">mtx_t</span> <span class="o">*</span><span class="kr">restrict</span> <span class="n">mtx</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="kr">restrict</span> <span class="n">ts</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">cnd_wait</span><span class="p">(</span><span class="n">cnd_t</span> <span class="o">*</span><span class="n">cond</span><span class="p">,</span> <span class="n">mtx_t</span> <span class="o">*</span><span class="n">mtx</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">mtx_destroy</span><span class="p">(</span><span class="n">mtx_t</span> <span class="o">*</span><span class="n">mtx</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">mtx_init</span><span class="p">(</span><span class="n">mtx_t</span> <span class="o">*</span><span class="n">mtx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">mtx_lock</span><span class="p">(</span><span class="n">mtx_t</span> <span class="o">*</span><span class="n">mtx</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">mtx_timedlock</span><span class="p">(</span><span class="n">mtx_t</span> <span class="o">*</span><span class="kr">restrict</span> <span class="n">mtx</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="kr">restrict</span> <span class="n">ts</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">mtx_trylock</span><span class="p">(</span><span class="n">mtx_t</span> <span class="o">*</span><span class="n">mtx</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">mtx_unlock</span><span class="p">(</span><span class="n">mtx_t</span> <span class="o">*</span><span class="n">mtx</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">thrd_create</span><span class="p">(</span><span class="n">thrd_t</span> <span class="o">*</span><span class="n">thr</span><span class="p">,</span> <span class="n">thrd_start_t</span> <span class="n">func</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">thrd_t</span> <span class="n">thrd_current</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">thrd_detach</span><span class="p">(</span><span class="n">thrd_t</span> <span class="n">thr</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">thrd_equal</span><span class="p">(</span><span class="n">thrd_t</span> <span class="n">thr0</span><span class="p">,</span> <span class="n">thrd_t</span> <span class="n">thr1</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="n">_Noreturn</span> <span class="kt">void</span> <span class="n">thrd_exit</span><span class="p">(</span><span class="kt">int</span> <span class="n">res</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">thrd_join</span><span class="p">(</span><span class="n">thrd_t</span> <span class="n">thr</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">res</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">thrd_sleep</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">duration</span><span class="p">,</span> <span class="k">struct</span> <span class="n">timespec</span><span class="o">*</span> <span class="n">remaining</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">thrd_yield</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">tss_create</span><span class="p">(</span><span class="n">tss_t</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="n">tss_dtor_t</span> <span class="n">dtor</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">tss_delete</span><span class="p">(</span><span class="n">tss_t</span> <span class="n">key</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="n">tss_get</span><span class="p">(</span><span class="n">tss_t</span> <span class="n">key</span><span class="p">);</span><span class="err">•</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">tss_set</span><span class="p">(</span><span class="n">tss_t</span> <span class="n">key</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="类型限定符">类型限定符</h2>
<h2 id="typedef">typedef</h2>
<h2 id="未定义类型">未定义类型</h2>
<h2 id="联合体">联合体</h2>
<h2 id="valgrind">Valgrind</h2>
<p>Valgrind是一个调试工具，可用于诊断C程序中有关内存管理的错误。Valgrind可用于检测诸如无效指针使用等错误，包括超出已分配空间的写入或读取，或对free()进行无效调用。它还可以通过执行内存分析的函数来改进应用程序。</p>
<h2 id="变量参数">变量参数</h2>
<h2 id="x-macros">X-macros</h2>
<p>x -宏是一种基于预处理程序的技术，用于最小化重复代码和维护数据/代码的对应关系。基于一组公共数据的多个不同的宏展开可以通过单个主宏来表示整个组展开，该宏的替换文本由内部宏展开的序列组成，每个数据对应一个。内部宏通常被命名为X()，这就是该技术的名称。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2022-05-14</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2022/05/0002-c%E8%AF%AD%E8%A8%80/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/linux/">linux</a>,&nbsp;<a href="/tags/c/">C</a>,&nbsp;<a href="/tags/c&#43;&#43;/">C&#43;&#43;</a>,&nbsp;<a href="/tags/c/c&#43;&#43;/">C/C&#43;&#43;</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2022/05/0001-c%E4%B8%8Ec-%E5%90%84%E4%B8%AA%E7%89%88%E6%9C%AC/" class="prev" rel="prev" title="C 与 C&#43;&#43; 各个版本"><i class="fas fa-angle-left fa-fw"></i>C 与 C&#43;&#43; 各个版本</a>
            <a href="/2022/05/0000-linux%E5%86%85%E6%A0%B8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="next" rel="next" title="Linux内核文件系统">Linux内核文件系统<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2017 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">ding jing</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/valine/Valine.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/algoliasearch/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/twemoji/twemoji.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"valine":{"appId":"oGOJ6TSiiaaOrhXD1bEYILk9-gzGzoHsz","appKey":"lbK71uSxpg4XmLmvm2h13JdJ","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"serverURLs":"https://ogoj6tsi.lc-cn-n1-shared.com","visitor":true}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.zh-cn","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
